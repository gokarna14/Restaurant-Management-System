import { useEffect } from 'react';

function useWatcher(watcher, _ref) {
  var updateOnAnimationFrame = _ref.updateOnAnimationFrame,
      enabled = _ref.enabled;
  useEffect(function () {
    var animationFrameId;
    var idleCallbackId; // do not track in node

    if (enabled && typeof window.requestAnimationFrame !== 'undefined') {
      var callback = function callback() {
        watcher();

        if (updateOnAnimationFrame) {
          animationFrameId = requestAnimationFrame(callback);
        } else {
          idleCallbackId = requestIdleCallback(callback);
        }
      };

      callback();
    }

    return function () {
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }

      if (idleCallbackId) {
        cancelIdleCallback(idleCallbackId);
      }
    };
  }, [updateOnAnimationFrame, watcher, enabled]);
}

export default useWatcher;